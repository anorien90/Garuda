services:
  garuda:
    build: .
    container_name: garuda-webapp
    restart: unless-stopped
    environment:
      - GARUDA_UI_API_KEY=${GARUDA_UI_API_KEY:-changeme}
      - GARUDA_DB_URL=${GARUDA_DB_URL:-sqlite:////app/data/crawler.db}
      - GARUDA_QDRANT_URL=${GARUDA_QDRANT_URL:-http://garuda-qdrant:6333}
      - GARUDA_QDRANT_COLLECTION=${GARUDA_QDRANT_COLLECTION:-pages}
      - GARUDA_OLLAMA_URL=${GARUDA_OLLAMA_URL:-http://garuda-ollama:11434/api/generate}
      - GARUDA_OLLAMA_MODEL=${GARUDA_OLLAMA_MODEL:-granite3.1-dense:8b}
      - GARUDA_UI_CORS_ORIGINS=*
    ports:
      - "8080:8080"
    volumes:
      - ./data/garuda/:/app/data/:rw
    depends_on:
      - qdrant
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]  # Remove this block if no GPU

  qdrant:
    image: qdrant/qdrant:latest
    container_name: garuda-qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
    volumes:
      - ./data/qdrant/:/qdrant/storage

  ollama:
    image: ollama/ollama:latest
    container_name: garuda-ollama
    restart: unless-stopped
    ports:
      - "11434:11434"
    profiles:
      - "llm"
    volumes:
      - ./data/ollama-llm:/root/.ollama:rw
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]  # Remove this block if no GPU

